<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>í¥ë¶€ì í†µí•© API ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Malgun Gothic',sans-serif; background:linear-gradient(135deg,#eef1f6 0%,#f8f9fb 100%); color:#333; padding:30px; }
        .container { max-width:1200px; margin:0 auto; }
        .header { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:25px; border-radius:12px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.1); margin-bottom:30px; }
        .header h1 { font-size:30px; font-weight:bold; margin-bottom:5px; }
        .auth-switch { display:flex; justify-content:center; gap:15px; margin-bottom:25px; }
        .auth-switch button { padding:12px 28px; border:none; border-radius:8px; font-weight:bold; font-size:15px; cursor:pointer; transition:all 0.3s; background:white; color:#667eea; box-shadow:0 3px 8px rgba(0,0,0,0.05); }
        .auth-switch button.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; box-shadow:0 4px 12px rgba(102,126,234,0.4); transform:translateY(-1px); }
        .section { background:white; border-radius:12px; padding:25px; margin-bottom:25px; box-shadow:0 3px 10px rgba(0,0,0,0.05); transition:all 0.2s; }
        .section.hidden { display:none; }
        .section-title { font-size:20px; font-weight:bold; color:#444; margin-bottom:20px; border-bottom:2px solid #667eea; padding-bottom:10px; }
        input, select, textarea { width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px; font-size:14px; }
        textarea { resize:vertical; min-height:80px; }
        .btn { padding:10px 20px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; transition:0.2s; }
        .btn-primary { background:#667eea; color:white; }
        .btn-primary:hover { background:#5568d3; }
        .btn-success { background:#2ecc71; color:white; }
        .btn-success:hover { background:#27ae60; }
        .response-box { margin-top:15px; padding:15px; border-radius:6px; display:none; font-family:'Courier New',monospace; font-size:13px; }
        .response-box.show { display:block; }
        .response-box.success { background:#d4edda; border-left:4px solid #28a745; }
        .response-box.error { background:#f8d7da; border-left:4px solid #dc3545; }

        /* ì‹ ê³  ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
        .emergency-list { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:15px; margin-top:10px; }
        .emergency-card { background:#fff; border-radius:10px; padding:15px; box-shadow:0 3px 8px rgba(0,0,0,0.08); transition:transform 0.2s ease, box-shadow 0.2s ease; }
        .emergency-card:hover { transform:translateY(-3px); box-shadow:0 6px 16px rgba(0,0,0,0.12); }
        .emergency-card .card-header { display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; }
        .emergency-card .report-id { color:#667eea; }
        .emergency-card .status { padding:3px 8px; border-radius:5px; font-size:12px; color:white; }
        .emergency-card.pending .status { background:#f39c12; }
        .emergency-card.confirmed .status { background:#e74c3c; }
        .emergency-card.resolved .status { background:#2ecc71; }
        .emergency-card.false_alarm .status { background:#95a5a6; }
        .emergency-card .ok { color:#2ecc71; font-weight:bold; }
        .emergency-card .no { color:#e74c3c; font-weight:bold; }
        .emergency-card .resolve-btn { width:100%; margin-top:10px; padding:8px; border:none; border-radius:6px; background:#2ecc71; color:white; font-weight:bold; cursor:pointer; }
        .emergency-card .resolved-label { margin-top:10px; background:#2ecc71; color:white; text-align:center; border-radius:6px; padding:8px 0; font-weight:bold; }

        /* ì–´ë¥´ì‹  ì¹´ë“œ */
        .users-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; margin-top:20px; }
        .user-card { background:white; border-radius:12px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.05); transition:all 0.3s; border-left:4px solid #ddd; }
        .user-card.status-active { border-left-color:#2ecc71; }
        .user-card.status-warning { border-left-color:#ffa502; }
        .user-card.status-emergency { border-left-color:#ff4757; animation:shake 0.4s infinite; }
        @keyframes shake { 0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);} }
        .user-header { display:flex; align-items:center; gap:10px; margin-bottom:15px; }
        .user-status-icon { font-size:24px; }
        .user-name { font-size:18px; font-weight:bold; }
        .user-room { color:#666; font-size:14px; }
        .user-activity { margin:15px 0; padding:12px; background:#f8f9fa; border-radius:8px; font-size:14px; }
        .user-activity .activity-type { font-weight:bold; margin-bottom:5px; }
        .user-activity .activity-detail { color:#666; }

        /* í™œë™ í”¼ë“œ */
        .activity-feed { background:white; border-radius:12px; padding:25px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-top:30px; }
        .activity-item { padding:15px; margin-bottom:10px; background:#f8f9fa; border-left:4px solid #ddd; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
        .activity-item.emergency { border-left-color:#ff4757; background:#fff5f5; }
        .activity-item.warning { border-left-color:#ffa502; background:#fffaf2; }
        .activity-time { font-size:12px; color:#999; }

        /* ëª¨ë‹¬ */
        .emergency-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000; }
        .emergency-modal.show { display:flex; }
        .modal-content { background:white; padding:40px; border-radius:16px; max-width:450px; width:90%; text-align:center; animation:modalPop 0.3s; }
        @keyframes modalPop { 0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1;} }
        .modal-icon { font-size:80px; margin-bottom:20px; }
        .modal-title { font-size:24px; font-weight:bold; margin-bottom:10px; color:#ff4757; }
        .modal-detail { color:#666; margin-bottom:30px; line-height:1.6; }
        .modal-actions { display:flex; gap:10px; }

        /* WebSocket ìƒíƒœ í‘œì‹œ */
        .ws-status { position:fixed; bottom:20px; right:20px; padding:10px 20px; background:white; border-radius:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); font-size:12px; display:flex; align-items:center; gap:8px; }
        .ws-indicator { width:8px; height:8px; border-radius:50%; background:#2ecc71; animation:blink 2s infinite; }
        @keyframes blink { 0%,100%{opacity:1;}50%{opacity:0.3;} }
        .hidden { display:none; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸµ í¥ë¶€ì ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <p>ì‹ ê³  / ì–´ë¥´ì‹  ìƒíƒœ í†µí•© ëª¨ë‹ˆí„°ë§</p>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="login-screen" class="section">
        <div class="section-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</div>
        <input id="username" type="text" placeholder="ì•„ì´ë””" value="admin_ssafy">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" value="password123">
        <button class="btn btn-primary" onclick="login()">ë¡œê·¸ì¸</button>
        <div id="login-error" class="response-box error"></div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ í™”ë©´ -->
    <div id="dashboard-screen" class="hidden">
        <div class="header">
            <h1>ğŸ¥ ê´€ë¦¬ì í˜ì´ì§€</h1>
            <div class="notification" onclick="clearBadge();">
                ğŸ””<span id="notification-badge" class="notification-badge" style="display:none;">0</span>
            </div>
        </div>

        <div class="dashboard">
            <div class="section-title">ğŸ“Š ì‹¤ì‹œê°„ ì‹ ê³  ë¦¬ìŠ¤íŠ¸</div>
            <div id="res-emg-list" class="response-box"></div>

            <div class="section-title">ğŸ§‘â€ğŸ¦³ ë‹´ë‹¹ ì–´ë¥´ì‹  í˜„í™©</div>
            <div id="users-grid" class="users-grid"></div>

            <div class="section-title">ğŸ“ í™œë™ í”¼ë“œ</div>
            <div class="activity-feed">
                <div id="activity-list"><div style="color:#999;text-align:center;">í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
            </div>
        </div>

        <div class="ws-status"><div class="ws-indicator"></div>ì‹¤ì‹œê°„ ì—°ê²°ë¨</div>
    </div>

    <!-- ì‹ ê³  ëª¨ë‹¬ -->
    <div id="emergency-modal" class="emergency-modal">
        <div class="modal-content">
            <div class="modal-icon">ğŸš¨</div>
            <div class="modal-title">ê¸´ê¸‰ ì‹ ê³  ë°œìƒ!</div>
            <div id="modal-detail" class="modal-detail"></div>
            <div class="modal-actions">
                <button class="btn btn-success" onclick="acknowledgeReport()">ì²˜ë¦¬ í™•ì¸</button>
                <button class="btn btn-primary" onclick="closeModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ì˜¤ë””ì˜¤ ì•Œë¦¼
    const alertAudio = new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg');

    // API ë² ì´ìŠ¤
    const API_BASE = 'http://localhost:8080/api';
    let accessToken = null;
    let adminId = null;
    let stompClient = null;

    // ì‹ ê³  ì¹´ë“œ ë°ì´í„° ì €ì¥
    let emergencyList = [];

    // ë¡œê·¸ì¸
    async function login(){
        const user = document.getElementById('username').value;
        const pwd  = document.getElementById('password').value;
        try {
            const res = await fetch(`${API_BASE}/admins/login`, {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({username:user, password:pwd})
            });
            if(!res.ok) throw new Error('ë¡œê·¸ì¸ ì‹¤íŒ¨');
            const data = await res.json();
            accessToken = data.accessToken;
            adminId     = data.userId;

            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard-screen').classList.remove('hidden');

            // ì´ˆê¸° ë¡œë“œ
            loadDashboardData();
            connectWebSocket();
        } catch(e) {
            const errEl = document.getElementById('login-error');
            errEl.style.display='block';
            errEl.textContent = e.message;
        }
    }

    // ë°ì´í„° ë¡œë“œ â€“ ë‹´ë‹¹ ì–´ë¥´ì‹  & ê¸°ì¡´ ì‹ ê³ 
    async function loadDashboardData(){
        try {
            // ì–´ë¥´ì‹  ëª©ë¡
            const resUsers = await fetch(`${API_BASE}/admins/users`, {
                headers: {Authorization: `Bearer ${accessToken}`}
            });
            if(resUsers.ok) {
                const users = await resUsers.json();
                renderUsers(users);
            }
            // ê¸°ì¡´ ì‹ ê³  ëª©ë¡
            const resEmg = await fetch(`${API_BASE}/emergency/admins/reports`, {
                headers: {Authorization: `Bearer ${accessToken}`}
            });
            if(resEmg.ok) {
                const list = await resEmg.json();
                emergencyList = list; // ì„œë²„ì—ì„œ ì´ë¯¸ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ë¨
                renderEmergencyCards(emergencyList);
                // PENDING + CONFIRMEDë§Œ ë°°ì§€ì— í‘œì‹œ
                const pendingCount = emergencyList.filter(i=>i.status==='PENDING' || i.status==='CONFIRMED').length;
                updateBadge(pendingCount);
            }
        } catch(e) {
            console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        }
    }

    // ì–´ë¥´ì‹  ì¹´ë“œ ë Œë”ë§
    function renderUsers(users){
        const grid = document.getElementById('users-grid');
        grid.innerHTML = '';
        users.forEach(u => {
            let cls = 'status-active';
            let icon = 'ğŸŸ¢';
            if (u.healthStatus === 'EMERGENCY') { cls = 'status-emergency'; icon = 'ğŸš¨'; }
            else if (!u.isActive)         { cls = 'status-warning';  icon = 'ğŸŸ¡'; }

            const div = document.createElement('div');
            div.className = `user-card ${cls}`;
            div.setAttribute('data-user-id', u.id);  // userId ì¶”ì ìš©
            div.innerHTML = `
            <div class="user-header"><span class="user-status-icon">${icon}</span>
                <div>
                  <div class="user-name">${u.name}</div>
                  <div class="user-room">${u.phoneNumber||''}</div>
                </div>
            </div>
            <div class="user-activity">
              <div class="activity-type">${u.healthStatus||'ì •ìƒ'} ìƒíƒœ</div>
              <div class="activity-detail">${u.address||''}</div>
            </div>
        `;
            grid.appendChild(div);
        });
    }

    // ì‹ ê³  ì¹´ë“œ ë Œë”ë§
    function renderEmergencyCards(list){
        const container = document.getElementById('res-emg-list');
        if (!Array.isArray(list) || list.length === 0) {
            container.className = 'response-box show success';
            container.innerHTML = '<p style="padding:10px;">ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        container.className = 'response-box show success';

        // ìƒíƒœ í•œê¸€ ë³€í™˜
        const statusText = {
            'PENDING': 'ëŒ€ê¸°ì¤‘',
            'CONFIRMED': 'í™•ì •ë¨',
            'RESOLVED': 'ì²˜ë¦¬ì™„ë£Œ',
            'FALSE_ALARM': 'ì˜¤íƒ'
        };

        container.innerHTML = `
      <div class="emergency-list">
        ${list.map(item => `
          <div class="emergency-card ${item.status.toLowerCase()}">
            <div class="card-header">
              <span class="report-id">#${item.reportId}</span>
              <span class="status">${statusText[item.status] || item.status}</span>
            </div>
            <div class="card-body">
              <p><strong>ì‹ ê³ ì:</strong> ${item.userName} (${item.userId})</p>
              <p><strong>ë°œí™” ë‚´ìš©:</strong> "${item.fullText || item.triggerWord}"</p>
              <p><strong>íŠ¸ë¦¬ê±° ë‹¨ì–´:</strong> ${item.triggerWord}</p>
              <p><strong>í™•ì¸ì—¬ë¶€:</strong>
                <span class="${item.isConfirmed?'ok':'no'}">
                  ${item.isConfirmed?'í™•ì¸ë¨':'ë¯¸í™•ì¸'}
                </span>
              </p>
              <p><strong>ë°œìƒì‹œê°„:</strong> ${new Date(item.reportedAt).toLocaleString('ko-KR')}</p>
              ${item.message?`<p><strong>ë©”ì‹œì§€:</strong> ${item.message}</p>`:''}
            </div>
            ${item.status==='PENDING' || item.status==='CONFIRMED'
            ? `<button class="resolve-btn" onclick="handleEmergencyResolve(${item.reportId})">âœ… ì²˜ë¦¬</button>`
            : `<div class="resolved-label">âœ” ì²˜ë¦¬ ì™„ë£Œ</div>`
        }
          </div>
        `).join('')}
      </div>
    `;
    }

    // ì‹ ê³  ì²˜ë¦¬ ë²„íŠ¼
    async function handleEmergencyResolve(id){
        if (!accessToken) { alert('ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!'); return; }
        const notes = 'ê´€ë¦¬ì í™•ì¸ ì™„ë£Œ';
        try {
            const res = await fetch(`${API_BASE}/emergency/admins/reports/${id}?notes=${encodeURIComponent(notes)}`, {
                method:'PUT',
                headers:{Authorization:`Bearer ${accessToken}`}
            });
            if (res.ok) {
                alert(`#${id} ì‹ ê³ ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);

                // ğŸ”¥ í•´ë‹¹ ì‹ ê³ ì˜ userId ì°¾ê¸°
                const report = emergencyList.find(item => item.reportId === id);
                if (report) {
                    // ì–´ë¥´ì‹  ì¹´ë“œë¥¼ ì •ìƒ ìƒíƒœë¡œ ë³µêµ¬
                    resetUserCardToNormal(report.userId);
                }

                // ìƒíƒœ ë³€ê²½ ë°˜ì˜
                emergencyList = emergencyList.map(item => item.reportId===id ? {...item, status:'RESOLVED'} : item);
                renderEmergencyCards(emergencyList);
                updateBadge(emergencyList.filter(i=>i.status==='PENDING' || i.status==='CONFIRMED').length);
            } else {
                const err = await res.json();
                alert('ì²˜ë¦¬ ì‹¤íŒ¨: '+(err.message||res.statusText));
            }
        } catch(e){
            alert('ì—ëŸ¬ ë°œìƒ: '+e.message);
        }
    }

    // WebSocket ì—°ê²°
    function connectWebSocket(){
        const socket = new SockJS(`${API_BASE}/ws`);
        stompClient = Stomp.over(socket);
        stompClient.connect({}, () => {
            console.log('âœ… WebSocket ì—°ê²° ì„±ê³µ!');
            console.log('ğŸ‘¤ í˜„ì¬ adminId:', adminId);
            const subscribePath = `/topic/admin/${adminId}/emergency`;
            console.log('ğŸ”” êµ¬ë… ê²½ë¡œ:', subscribePath);

            stompClient.subscribe(subscribePath, msg => {
                console.log('ğŸ“© WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ !', msg.body);
                const alertData = JSON.parse(msg.body);
                alertAudio.play();

                // Null-safe ì²˜ë¦¬
                const userName = alertData.userName || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const triggerWord = alertData.triggerWord || 'ë¯¸ìƒ';
                const fullText = alertData.fullText || triggerWord;  // ì „ì²´ ë°œí™” í…ìŠ¤íŠ¸

                addActivity('emergency', userName, `ì‹ ê³ : "${fullText}"`);

                // ğŸ”¥ í•´ë‹¹ ì–´ë¥´ì‹  ì¹´ë“œë¥¼ ì¦‰ì‹œ ê¸´ê¸‰ ìƒíƒœë¡œ ë³€ê²½
                updateUserCardToEmergency(alertData.userId, userName);

                // ğŸ”¥ ë Œë”ë§ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜í•´ì„œ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
                const emergencyItem = {
                    reportId: alertData.reportId,
                    userId: alertData.userId,
                    userName: userName,
                    triggerWord: triggerWord,
                    fullText: fullText,  // ì „ì²´ ë°œí™” í…ìŠ¤íŠ¸ ì¶”ê°€
                    reportedAt: alertData.reportedAt,
                    status: 'CONFIRMED',      // WebSocketìœ¼ë¡œ ì˜¨ ê±´ ì´ë¯¸ confirmëœ ìƒíƒœ
                    isConfirmed: true,
                    message: null
                };

                // ë¦¬ìŠ¤íŠ¸ ìµœìƒë‹¨ì— ì¶”ê°€
                emergencyList.unshift(emergencyItem);
                renderEmergencyCards(emergencyList);
                updateBadge(emergencyList.filter(i=>i.status==='PENDING' || i.status==='CONFIRMED').length);

                // ëª¨ë‹¬ íŒì—…
                document.getElementById('modal-detail').innerHTML =
                    `<b>${userName}</b> ì–´ë¥´ì‹ ì´ ê¸´ê¸‰ ì‹ ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.<br>
               ë°œí™” ë‚´ìš©: "<strong>${fullText}</strong>"<br>
               íŠ¸ë¦¬ê±° ë‹¨ì–´: "<strong>${triggerWord}</strong>"<br>
               ë°œìƒì‹œê°„: ${new Date(alertData.reportedAt).toLocaleString('ko-KR')}`;
                document.getElementById('emergency-modal').classList.add('show');
            });
            stompClient.subscribe(`/topic/admin/${adminId}/user-status`, msg => {
                const statusData = JSON.parse(msg.body);
                addActivity(statusData.status==='EMERGENCY'?'emergency':'warning',
                    statusData.userName, statusData.message);
                loadDashboardData(); // ì–´ë¥´ì‹  ì¹´ë“œ ìƒíƒœ ê°±ì‹ 
            });
        });
    }

    // ğŸ”¥ ì–´ë¥´ì‹  ì¹´ë“œë¥¼ ê¸´ê¸‰ ìƒíƒœë¡œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    function updateUserCardToEmergency(userId, userName) {
        const card = document.querySelector(`.user-card[data-user-id="${userId}"]`);
        if (!card) {
            console.warn(`User card not found for userId: ${userId}`);
            return;
        }

        // ê¸°ì¡´ status í´ë˜ìŠ¤ ì œê±° í›„ emergency ì¶”ê°€
        card.classList.remove('status-active', 'status-warning');
        card.classList.add('status-emergency');

        // ì•„ì´ì½˜ ë³€ê²½
        const icon = card.querySelector('.user-status-icon');
        if (icon) icon.textContent = 'ğŸš¨';

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€ê²½
        const activityType = card.querySelector('.activity-type');
        if (activityType) activityType.textContent = 'EMERGENCY ìƒíƒœ';

        console.log(`âœ… User card updated to EMERGENCY for userId: ${userId}, name: ${userName}`);
    }

    // ğŸ”¥ ì–´ë¥´ì‹  ì¹´ë“œë¥¼ ì •ìƒ ìƒíƒœë¡œ ë³µêµ¬
    function resetUserCardToNormal(userId) {
        const card = document.querySelector(`.user-card[data-user-id="${userId}"]`);
        if (!card) {
            console.warn(`User card not found for userId: ${userId}`);
            return;
        }

        // emergency í´ë˜ìŠ¤ ì œê±°, active ì¶”ê°€
        card.classList.remove('status-emergency', 'status-warning');
        card.classList.add('status-active');

        // ì•„ì´ì½˜ì„ ì •ìƒìœ¼ë¡œ ë³€ê²½
        const icon = card.querySelector('.user-status-icon');
        if (icon) icon.textContent = 'ğŸŸ¢';

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€ê²½
        const activityType = card.querySelector('.activity-type');
        if (activityType) activityType.textContent = 'ì •ìƒ ìƒíƒœ';

        console.log(`âœ… User card reset to NORMAL for userId: ${userId}`);
    }

    // í™œë™ í”¼ë“œ
    function addActivity(type,userName,detail){
        const list = document.getElementById('activity-list');
        if(list.children.length===1 && list.children[0].textContent.includes('í™œë™ ë‚´ì—­')) {
            list.innerHTML='';
        }
        const item = document.createElement('div');
        item.className=`activity-item ${type}`;
        item.innerHTML=`<div>${type==='emergency'?'ğŸš¨':'âš ï¸'} <strong>${userName}</strong> - ${detail}</div>
                     <div class="activity-time">${new Date().toLocaleTimeString('ko-KR')}</div>`;
        list.prepend(item);
        while(list.children.length>10) list.removeChild(list.lastChild);
    }

    // ë°°ì§€ ì—…ë°ì´íŠ¸
    function updateBadge(count){
        const badge = document.getElementById('notification-badge');
        if(count>0) {
            badge.style.display='flex';
            badge.textContent = count;
        } else {
            badge.style.display='none';
        }
    }
    function clearBadge(){
        updateBadge(0);
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(){
        document.getElementById('emergency-modal').classList.remove('show');
    }
    function acknowledgeReport(){
        // ëª¨ë‹¬ì—ì„œ ì²˜ë¦¬ ë²„íŠ¼ ëˆ„ë¥´ë©´ ëª¨ë‹¬ë§Œ ë‹«ê³  ë¦¬ìŠ¤íŠ¸ëŠ” ì¹´ë“œ ë²„íŠ¼ìœ¼ë¡œ ì²˜ë¦¬
        closeModal();
    }
</script>
</body>
</html>
