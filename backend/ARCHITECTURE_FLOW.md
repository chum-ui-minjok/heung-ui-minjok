# üéµ Ìù•Î∂ÄÏûê ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò ÌùêÎ¶ÑÎèÑ

## üìã Î™©Ï∞®
1. [Ï†ÑÏ≤¥ ÎèÑÎ©îÏù∏ Íµ¨Ï°∞](#Ï†ÑÏ≤¥-ÎèÑÎ©îÏù∏-Íµ¨Ï°∞)
2. [Ïù∏Ï¶ù ÌùêÎ¶Ñ](#Ïù∏Ï¶ù-ÌùêÎ¶Ñ)
3. [ÏùåÏÑ± Î™ÖÎ†π Ï≤òÎ¶¨ ÌùêÎ¶Ñ](#ÏùåÏÑ±-Î™ÖÎ†π-Ï≤òÎ¶¨-ÌùêÎ¶Ñ)
4. [Í∏¥Í∏â Ïã†Í≥† ÌùêÎ¶Ñ](#Í∏¥Í∏â-Ïã†Í≥†-ÌùêÎ¶Ñ)
5. [ÎèÑÎ©îÏù∏ Í∞Ñ ÏùòÏ°¥ÏÑ±](#ÎèÑÎ©îÏù∏-Í∞Ñ-ÏùòÏ°¥ÏÑ±)

---

## Ï†ÑÏ≤¥ ÎèÑÎ©îÏù∏ Íµ¨Ï°∞

```
Ìù•Î∂ÄÏûê ÏãúÏä§ÌÖú
‚îú‚îÄ‚îÄ üë• User/Admin (Ïù∏Ï¶ù & ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨)
‚îÇ   ‚îú‚îÄ‚îÄ Admin: Í¥ÄÎ¶¨Ïûê (username/password Î°úÍ∑∏Ïù∏)
‚îÇ   ‚îî‚îÄ‚îÄ User: ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê/Ïñ¥Î•¥Ïã† (Í∏∞Í∏∞ serialNumber Î°úÍ∑∏Ïù∏)
‚îÇ
‚îú‚îÄ‚îÄ üé§ Voice (ÏùåÏÑ± Ïù∏ÌÑ∞ÌéòÏù¥Ïä§)
‚îÇ   ‚îú‚îÄ‚îÄ STT Service: ÏùåÏÑ± ‚Üí ÌÖçÏä§Ìä∏ Î≥ÄÌôò
‚îÇ   ‚îú‚îÄ‚îÄ TTS Service: ÌÖçÏä§Ìä∏ ‚Üí ÏùåÏÑ± Î≥ÄÌôò
‚îÇ   ‚îî‚îÄ‚îÄ VoiceCommand: Î™ÖÎ†π Î°úÍ∑∏ Ï†ÄÏû•
‚îÇ
‚îú‚îÄ‚îÄ üß† Command (Î™ÖÎ†π Î∂ÑÏÑù & Ïò§ÏºÄÏä§Ìä∏Î†àÏù¥ÏÖò)
‚îÇ   ‚îú‚îÄ‚îÄ IntentClassifier: ÏùòÎèÑ Î∂ÑÏÑù (ÍµêÏ≤¥ Í∞ÄÎä•)
‚îÇ   ‚îú‚îÄ‚îÄ CommandService: Ï†ÑÏ≤¥ ÌùêÎ¶Ñ Ï°∞Ïú®
‚îÇ   ‚îî‚îÄ‚îÄ ResponseGenerator: ÏùëÎãµ ÌÖçÏä§Ìä∏ ÏÉùÏÑ±
‚îÇ
‚îú‚îÄ‚îÄ üéµ Song/Music (ÎÖ∏Îûò & Ïû¨ÏÉù)
‚îÇ   ‚îú‚îÄ‚îÄ Song: ÎÖ∏Îûò Ï†ïÎ≥¥ (Ï†úÎ™©, Í∞ÄÏàò, S3 URL)
‚îÇ   ‚îú‚îÄ‚îÄ SongService: ÎÖ∏Îûò Í≤ÄÏÉâ
‚îÇ   ‚îî‚îÄ‚îÄ ListeningHistory: Ï≤≠Ï∑® Ïù¥Î†• Í∏∞Î°ù
‚îÇ
‚îî‚îÄ‚îÄ üö® Emergency (Í∏¥Í∏â Ïã†Í≥†)
    ‚îú‚îÄ‚îÄ EmergencyReport: Ïã†Í≥† ÎÇ¥Ïó≠
    ‚îú‚îÄ‚îÄ EmergencyService: Ïã†Í≥† Ï≤òÎ¶¨
    ‚îî‚îÄ‚îÄ WebSocket: Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º
```

---

## Ïù∏Ï¶ù ÌùêÎ¶Ñ

### 1Ô∏è‚É£ Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏

```
Frontend                  AuthController              AdminService              JwtTokenProvider
   |                            |                           |                           |
   | POST /api/admins/login     |                           |                           |
   |---------------------------->|                           |                           |
   | { username, password }      |                           |                           |
   |                            |                           |                           |
   |                            | login(request)            |                           |
   |                            |-------------------------->|                           |
   |                            |                           | ÎπÑÎ∞ÄÎ≤àÌò∏ Í≤ÄÏ¶ù             |
   |                            |                           |                           |
   |                            |                           | generateToken(adminId)    |
   |                            |                           |-------------------------->|
   |                            |                           |                           |
   |                            |                           | TokenResponse             |
   |                            | TokenResponse             |<--------------------------|
   |  TokenResponse             |<--------------------------|                           |
   |<---------------------------|                           |                           |
   | {                          |                           |                           |
   |   accessToken,             |                           |                           |
   |   refreshToken,            |                           |                           |
   |   userId,                  |                           |                           |
   |   role: "ADMIN"            |                           |                           |
   | }                          |                           |                           |
```

### 2Ô∏è‚É£ ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê(Í∏∞Í∏∞) Î°úÍ∑∏Ïù∏

```
IoT Device                AuthController              AuthService                DeviceRepository
   |                            |                           |                           |
   | POST /api/auth/device      |                           |                           |
   |---------------------------->|                           |                           |
   | { serialNumber }            |                           |                           |
   |                            |                           |                           |
   |                            | deviceLogin(request)      |                           |
   |                            |-------------------------->|                           |
   |                            |                           | findBySerialNumber()      |
   |                            |                           |-------------------------->|
   |                            |                           |                           |
   |                            |                           | Device + User Ï†ïÎ≥¥        |
   |                            |                           |<--------------------------|
   |                            |                           | generateToken(userId)     |
   |                            |                           |                           |
   |  TokenResponse             | TokenResponse             |                           |
   |<---------------------------|<--------------------------|                           |
   | {                          |                           |                           |
   |   accessToken,             |                           |                           |
   |   userId,                  |                           |                           |
   |   role: "USER"             |                           |                           |
   | }                          |                           |                           |
```

---

## ÏùåÏÑ± Î™ÖÎ†π Ï≤òÎ¶¨ ÌùêÎ¶Ñ

### üéØ Ï†ÑÏ≤¥ ÌùêÎ¶Ñ (ÏùåÏÑ± ÌååÏùº ‚Üí ÎÖ∏Îûò Ïû¨ÏÉù)

```
IoT/Frontend         CommandController       SttService      CommandService      IntentClassifier    SongService     ListeningHistory    TtsService
     |                      |                     |                  |                    |                  |                  |                |
     | 1. ÏùåÏÑ± ÏóÖÎ°úÎìú       |                     |                  |                    |                  |                  |                |
     |--------------------->|                     |                  |                    |                  |                  |                |
     | POST /commands/process                     |                  |                    |                  |                  |                |
     | { userId, audioFile }|                     |                  |                    |                  |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     |                      | 2. STT Î≥ÄÌôò         |                  |                    |                  |                  |                |
     |                      |-------------------->|                  |                    |                  |                  |                |
     |                      |                     | Whisper API      |                    |                  |                  |                |
     |                      |                     | "ÌÉúÏßÑÏïÑ ÎÖ∏Îûò ÌãÄÏñ¥Ï§ò"|                  |                    |                  |                  |                |
     |                      |   ÌÖçÏä§Ìä∏ Î∞òÌôò        |                  |                    |                  |                  |                |
     |                      |<--------------------|                  |                    |                  |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     |                      | 3. Î™ÖÎ†π Ï≤òÎ¶¨        |                  |                    |                  |                  |                |
     |                      |-------------------------------->|                    |                  |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     |                      |                     |                  | 4. ÏùòÎèÑ Î∂ÑÏÑù       |                  |                  |                |
     |                      |                     |                  |------------------->|                  |                  |                |
     |                      |                     |                  |                    | ÌÇ§ÏõåÎìú Îß§Ïπ≠      |                  |                |
     |                      |                     |                  |                    | Intent: SELECT_BY_ARTIST |          |                |
     |                      |                     |                  | IntentResult       | entity: {artist: "ÌÉúÏßÑÏïÑ"} |        |                |
     |                      |                     |                  |<-------------------|                  |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     |                      |                     |                  | 5. ÎÖ∏Îûò Í≤ÄÏÉâ       |                  |                  |                |
     |                      |                     |                  |------------------------------------------->|                  |                |
     |                      |                     |                  |                    |                  | DB Query         |                |
     |                      |                     |                  |                    |                  | WHERE artist LIKE '%ÌÉúÏßÑÏïÑ%'       |
     |                      |                     |                  | Song Ï†ïÎ≥¥          |                  |                  |                |
     |                      |                     |                  |<-------------------------------------------|                  |                |
     |                      |                     |                  | { id, title, artist, s3Url }              |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     |                      |                     |                  | 6. Ï≤≠Ï∑® Ïù¥Î†• Í∏∞Î°ù  |                  |                  |                |
     |                      |                     |                  |-------------------------------------------------------->|                |
     |                      |                     |                  |                    |                  |                  | INSERT history |
     |                      |                     |                  |                    |                  |                  | (user, song, mode) |
     |                      |                     |                  |                    |                  |                  |                |
     |                      |                     |                  | 7. TTS ÏùëÎãµ ÏÉùÏÑ±   |                  |                  |                |
     |                      |                     |                  |-------------------------------------------------------------------------->|
     |                      |                     |                  |                    |                  |                  |                | OpenAI TTS
     |                      |                     |                  |                    |                  |                  |                | "ÌÉúÏßÑÏïÑÏùò ÏÇ¨ÎûëÏùÄ..."
     |                      |                     |                  | TTS fileId         |                  |                  |                |
     |                      |                     |                  |<--------------------------------------------------------------------------|
     |                      |                     |                  |                    |                  |                  |                |
     |                      | CommandResponse     |                  |                    |                  |                  |                |
     |<---------------------|<--------------------------------|                    |                  |                  |                |
     | {                   |                     |                  |                    |                  |                  |                |
     |   success: true,    |                     |                  |                    |                  |                  |                |
     |   intent: SELECT_BY_ARTIST,              |                  |                    |                  |                  |                |
     |   responseText: "...",                    |                  |                    |                  |                  |                |
     |   ttsFileUrl: "/api/commands/tts/abc123",|                  |                    |                  |                  |                |
     |   songInfo: {       |                     |                  |                    |                  |                  |                |
     |     songId, title,  |                     |                  |                    |                  |                  |                |
     |     artist, audioUrl|                     |                  |                    |                  |                  |                |
     |   }                 |                     |                  |                    |                  |                  |                |
     | }                   |                     |                  |                    |                  |                  |                |
     |                      |                     |                  |                    |                  |                  |                |
     | 8. ÌîÑÎ°†Ìä∏ÏóîÎìú Ï≤òÎ¶¨   |                     |                  |                    |                  |                  |                |
     | - TTS Ïû¨ÏÉù          |                     |                  |                    |                  |                  |                |
     | - ÏùåÏïÖ Ïû¨ÏÉù (audioUrl)|                   |                  |                    |                  |                  |                |
```

### üéÆ Ïû¨ÏÉù Ï†úÏñ¥ Î™ÖÎ†π (ÏùºÏãúÏ†ïÏßÄ, Ïû¨ÏÉù, Îã§ÏùåÍ≥° Îì±)

```
IoT/Frontend         CommandController       CommandService      IntentClassifier    TtsService
     |                      |                     |                     |                 |
     | POST /commands/text  |                     |                     |                 |
     |--------------------->|                     |                     |                 |
     | { userId, text: "ÏùåÏïÖ Î©àÏ∂∞" }             |                     |                 |
     |                      |                     |                     |                 |
     |                      | processTextCommand()|                     |                 |
     |                      |-------------------->|                     |                 |
     |                      |                     | classify()          |                 |
     |                      |                     |-------------------->|                 |
     |                      |                     |                     | Intent: MUSIC_PAUSE |
     |                      |                     | IntentResult        |                 |
     |                      |                     |<--------------------|                 |
     |                      |                     |                     |                 |
     |                      |                     | ‚ö†Ô∏è Ï§ëÏöî: Î∞±ÏóîÎìúÎäî ÏÉÅÌÉú Í¥ÄÎ¶¨ Ïïà Ìï® |
     |                      |                     | TTS ÏùëÎãµÎßå ÏÉùÏÑ±     |                 |
     |                      |                     |------------------------------------>|
     |                      |                     | TTS fileId          |                 |
     |                      |                     |<------------------------------------|
     |                      |                     |                     |                 |
     |                      | CommandResponse     |                     |                 |
     |<---------------------|<--------------------|                     |                 |
     | {                   |                     |                     |                 |
     |   success: true,    |                     |                     |                 |
     |   intent: MUSIC_PAUSE,                    |                     |                 |
     |   responseText: "ÏùåÏïÖÏùÑ ÏùºÏãúÏ†ïÏßÄ Ìï©ÎãàÎã§", |                     |                 |
     |   ttsFileUrl: "...", |                     |                     |                 |
     |   songInfo: null    // ‚ö†Ô∏è Ïû¨ÏÉù Ï†úÏñ¥Îäî songInfo ÏóÜÏùå              |
     | }                   |                     |                     |                 |
     |                      |                     |                     |                 |
     | ‚úÖ ÌîÑÎ°†Ìä∏ÏóîÎìúÍ∞Ä ÏßÅÏ†ë Ï†úÏñ¥ (play/pause/next)                        |
```

---

## Í∏¥Í∏â Ïã†Í≥† ÌùêÎ¶Ñ

### üö® ÏùåÏÑ± Î™ÖÎ†πÏùÑ ÌÜµÌïú Í∏¥Í∏â Ïã†Í≥†

```
IoT Device           CommandController       CommandService      IntentClassifier    EmergencyService    WebSocket           Admin Dashboard
     |                      |                     |                     |                   |                  |                      |
     | 1. Í∏¥Í∏â ÏùåÏÑ±         |                     |                     |                   |                  |                      |
     | "ÎèÑÏôÄÏ§ò!"           |                     |                     |                   |                  |                      |
     |--------------------->|                     |                     |                   |                  |                      |
     | POST /commands/process                     |                     |                   |                  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      | STT ‚Üí "ÎèÑÏôÄÏ§ò"      |                     |                   |                  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      | processTextCommand()|                     |                   |                  |                      |
     |                      |-------------------->|                     |                   |                  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      |                     | classify()          |                   |                  |                      |
     |                      |                     |-------------------->|                   |                  |                      |
     |                      |                     |                     | Intent: EMERGENCY |                  |                      |
     |                      |                     | IntentResult        | keyword: "ÎèÑÏôÄÏ§ò" |                  |                      |
     |                      |                     |<--------------------|                   |                  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      |                     | 2. Í∏¥Í∏â Ïã†Í≥† ÏÉùÏÑ±   |                   |                  |                      |
     |                      |                     |------------------------------------>|                  |                      |
     |                      |                     |                     |                   | DB Insert        |                      |
     |                      |                     |                     |                   | EmergencyReport  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      |                     |                     |                   | 3. WebSocket ÏïåÎ¶º|                      |
     |                      |                     |                     |                   |----------------->|                      |
     |                      |                     |                     |                   |                  | Ïã§ÏãúÍ∞Ñ Ìë∏Ïãú          |
     |                      |                     |                     |                   |                  |--------------------->|
     |                      |                     |                     |                   |                  |                      | üö® ÏïåÎ¶º ÌëúÏãú!
     |                      |                     |                     |                   |                  |                      | "ÌôçÍ∏∏Îèô Ïñ¥Î•¥Ïã† Í∏¥Í∏â"
     |                      |                     | EmergencyResponse   |                   |                  |                      |
     |                      |                     |<------------------------------------|                  |                      |
     |                      |                     |                     |                   |                  |                      |
     |                      | CommandResponse     |                     |                   |                  |                      |
     |<---------------------|<--------------------|                     |                   |                  |                      |
     | {                   |                     |                     |                   |                  |                      |
     |   success: true,    |                     |                     |                   |                  |                      |
     |   intent: EMERGENCY,|                     |                     |                   |                  |                      |
     |   responseText: "Í∏¥Í∏â Ïã†Í≥†Í∞Ä Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§",                     |                   |                  |                      |
     |   ttsFileUrl: "..." |                     |                     |                   |                  |                      |
     | }                   |                     |                     |                   |                  |                      |
```

### üë®‚Äç‚öïÔ∏è Í¥ÄÎ¶¨ÏûêÏùò Í∏¥Í∏â Ïã†Í≥† Ï≤òÎ¶¨

```
Admin Dashboard      EmergencyController     EmergencyService        WebSocket           User/Family
     |                      |                     |                       |                      |
     | 1. Ïã†Í≥† ÌôïÏù∏         |                     |                       |                      |
     | PUT /emergency/admins/reports/{id}        |                       |                      |
     |--------------------->|                     |                       |                      |
     | { notes: "Íµ¨Í∏âÏ∞® Ï∂úÎèô" }                   |                       |                      |
     |                      |                     |                       |                      |
     |                      | handleReport()      |                       |                      |
     |                      |-------------------->|                       |                      |
     |                      |                     | UPDATE status         |                      |
     |                      |                     | HANDLED               |                      |
     |                      |                     |                       |                      |
     |                      |                     | sendNotification()    |                      |
     |                      |                     |---------------------->|                      |
     |                      |                     |                       | Í∞ÄÏ°±ÏóêÍ≤å ÏïåÎ¶º        |
     |                      |                     |                       |--------------------->|
     |                      |                     |                       |                      | ‚úÖ "Ï≤òÎ¶¨ ÏôÑÎ£å"
     |                      | 204 No Content      |                       |                      |
     |<---------------------|<--------------------|                       |                      |
```

---

## ÎèÑÎ©îÏù∏ Í∞Ñ ÏùòÏ°¥ÏÑ±

### üìä ÏùòÏ°¥ÏÑ± Î∞©Ìñ• (‚Üí)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Command (Ïò§ÏºÄÏä§Ìä∏Î†àÏù¥ÌÑ∞)                   ‚îÇ
‚îÇ  - Ï†ÑÏ≤¥ ÌùêÎ¶Ñ Ï°∞Ïú®                                            ‚îÇ
‚îÇ  - Í∞Å ÎèÑÎ©îÏù∏ ÏÑúÎπÑÏä§ Ìò∏Ï∂ú                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì           ‚Üì           ‚Üì           ‚Üì           ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ User   ‚îÇ  ‚îÇ Voice  ‚îÇ  ‚îÇ Song   ‚îÇ  ‚îÇListening‚îÇ  ‚îÇEmergency‚îÇ
    ‚îÇ        ‚îÇ  ‚îÇ        ‚îÇ  ‚îÇ        ‚îÇ  ‚îÇHistory ‚îÇ  ‚îÇ        ‚îÇ
    ‚îÇService ‚îÇ  ‚îÇService ‚îÇ  ‚îÇService ‚îÇ  ‚îÇService ‚îÇ  ‚îÇService ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì           ‚Üì           ‚Üì           ‚Üì           ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ User   ‚îÇ  ‚îÇ Voice  ‚îÇ  ‚îÇ Song   ‚îÇ  ‚îÇListening‚îÇ  ‚îÇEmergency‚îÇ
    ‚îÇ        ‚îÇ  ‚îÇCommand ‚îÇ  ‚îÇ        ‚îÇ  ‚îÇHistory ‚îÇ  ‚îÇReport  ‚îÇ
    ‚îÇEntity  ‚îÇ  ‚îÇEntity  ‚îÇ  ‚îÇEntity  ‚îÇ  ‚îÇEntity  ‚îÇ  ‚îÇEntity  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîå Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Í∏∞Î∞ò ÏÑ§Í≥Ñ (ÎäêÏä®Ìïú Í≤∞Ìï©)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         CommandService                   ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ÏùòÏ°¥ (Ïù∏ÌÑ∞ÌéòÏù¥Ïä§):                      ‚îÇ
‚îÇ  - IntentClassifier (Ïù∏ÌÑ∞ÌéòÏù¥Ïä§) ‚úÖ       ‚îÇ
‚îÇ  - TtsService (Ïù∏ÌÑ∞ÌéòÏù¥Ïä§) ‚úÖ            ‚îÇ
‚îÇ  - SttService (Ïù∏ÌÑ∞ÌéòÏù¥Ïä§) ‚úÖ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üì
         Íµ¨ÌòÑÏ≤¥Îäî ÍµêÏ≤¥ Í∞ÄÎä•!
                  ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  IntentClassifier Íµ¨ÌòÑÏ≤¥:             ‚îÇ
    ‚îÇ  - KeywordBasedIntentClassifier (ÌòÑÏû¨)‚îÇ
    ‚îÇ  - RagBasedIntentClassifier (ÎØ∏Îûò)   ‚îÇ
    ‚îÇ  - LlmBasedIntentClassifier (ÎØ∏Îûò)   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  TtsService Íµ¨ÌòÑÏ≤¥:                   ‚îÇ
    ‚îÇ  - OpenAiTtsServiceImpl (prod)       ‚îÇ
    ‚îÇ  - SimpleTtsServiceImpl (local)      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  SttService Íµ¨ÌòÑÏ≤¥:                   ‚îÇ
    ‚îÇ  - OpenAiWhisperSttServiceImpl (prod)‚îÇ
    ‚îÇ  - MockSttServiceImpl (local)        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚ú® Spring ProfileÎ°ú ÏûêÎèô ÏÑ†ÌÉù:
   - prod: OpenAI Íµ¨ÌòÑÏ≤¥
   - local: Mock Íµ¨ÌòÑÏ≤¥
```

---

## ÌïµÏã¨ ÏÑ§Í≥Ñ ÏõêÏπô

### ‚úÖ 1. Ïó≠Ìï† Î∂ÑÎ¶¨

| ÎèÑÎ©îÏù∏ | Ï±ÖÏûÑ | ÏùòÏ°¥ |
|--------|------|------|
| **Command** | Ïò§ÏºÄÏä§Ìä∏Î†àÏù¥ÏÖò, ÌùêÎ¶Ñ Ï†úÏñ¥ | Voice, Song, Emergency, User |
| **Voice** | STT/TTS, ÏùåÏÑ± Ï≤òÎ¶¨ | ÏóÜÏùå (ÏàúÏàò Í∏∞Ïà†) |
| **Song** | ÎÖ∏Îûò Ï†ïÎ≥¥ Í¥ÄÎ¶¨, Í≤ÄÏÉâ | ÏóÜÏùå |
| **ListeningHistory** | Ï≤≠Ï∑® Ïù¥Î†• Í∏∞Î°ù | User, Song |
| **Emergency** | Í∏¥Í∏â Ïã†Í≥† Ï≤òÎ¶¨ | User, WebSocket |
| **User/Admin** | ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨, Ïù∏Ï¶ù | ÏóÜÏùå |

### ‚úÖ 2. ÌîÑÎ°†Ìä∏ÏóîÎìú/Î∞±ÏóîÎìú Ï±ÖÏûÑ Î∂ÑÎ¶¨

| Ï±ÖÏûÑ | Îã¥Îãπ |
|------|------|
| **ÏùåÏïÖ Ïû¨ÏÉù ÏÉÅÌÉú Í¥ÄÎ¶¨** (play/pause/stop) | üñ•Ô∏è Frontend |
| **ÏùåÏïÖ Ïû¨ÏÉù UI** | üñ•Ô∏è Frontend |
| **ÎÖ∏Îûò Ï†ïÎ≥¥ Ï†úÍ≥µ** (audioUrl) | üîß Backend |
| **Ï≤≠Ï∑® Ïù¥Î†• Í∏∞Î°ù** | üîß Backend |
| **ÎÖ∏Îûò Í≤ÄÏÉâ** | üîß Backend |
| **ÏùåÏÑ± Ïù∏Ïãù/Ìï©ÏÑ±** | üîß Backend |

### ‚úÖ 3. Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Í∏∞Î∞ò ÏÑ§Í≥Ñ

- **Î™©Ï†Å**: Íµ¨ÌòÑÏ≤¥ ÍµêÏ≤¥ Í∞ÄÎä• (ÌÇ§ÏõåÎìú ‚Üí RAG ‚Üí LLM)
- **Î∞©Î≤ï**:
  - `@Service` + `@Primary` + `@Profile` Ï°∞Ìï©
  - ÏùòÏ°¥ÏÑ±ÏùÄ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î°úÎßå Ï£ºÏûÖ
  - `CommandService`Îäî Íµ¨ÌòÑÏ≤¥Î•º Î™∞ÎùºÎèÑ Îê®

### ‚úÖ 4. Îã®Î∞©Ìñ• ÏùòÏ°¥ÏÑ±

```
Command ‚Üí Voice (O)
Voice ‚Üí Command (X) ‚ùå

Command ‚Üí Song (O)
Song ‚Üí Command (X) ‚ùå

Emergency ‚Üí User (O)
User ‚Üí Emergency (X) ‚ùå
```

---

## API ÏóîÎìúÌè¨Ïù∏Ìä∏ Ï†ïÎ¶¨

### üîê Ïù∏Ï¶ù

| Î©îÏÑúÎìú | Í≤ΩÎ°ú | ÏÑ§Î™Ö | Ïù∏Ï¶ù ÌïÑÏöî |
|--------|------|------|----------|
| POST | `/api/admins/register` | Í¥ÄÎ¶¨Ïûê ÌöåÏõêÍ∞ÄÏûÖ | ‚ùå |
| POST | `/api/admins/login` | Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ | ‚ùå |
| POST | `/api/auth/device` | Í∏∞Í∏∞ Î°úÍ∑∏Ïù∏ (ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê) | ‚ùå |

### üé§ ÏùåÏÑ± Î™ÖÎ†π

| Î©îÏÑúÎìú | Í≤ΩÎ°ú | ÏÑ§Î™Ö | Ïù∏Ï¶ù ÌïÑÏöî |
|--------|------|------|----------|
| POST | `/api/commands/process` | ÏùåÏÑ± ÌååÏùº ‚Üí Î™ÖÎ†π Ï≤òÎ¶¨ | ‚ùå (userId) |
| POST | `/api/commands/text` | ÌÖçÏä§Ìä∏ Î™ÖÎ†π Ï≤òÎ¶¨ (ÎîîÎ≤ÑÍπÖ) | ‚ùå (userId) |
| GET | `/api/commands/tts/{fileId}` | TTS ÌååÏùº Îã§Ïö¥Î°úÎìú | ‚ùå |

### üö® Í∏¥Í∏â Ïã†Í≥†

| Î©îÏÑúÎìú | Í≤ΩÎ°ú | ÏÑ§Î™Ö | Ïù∏Ï¶ù ÌïÑÏöî |
|--------|------|------|----------|
| POST | `/api/emergency` | Í∏¥Í∏â Ïã†Í≥† ÏÉùÏÑ± | ‚ùå |
| GET | `/api/emergency/admins/reports` | ÎåÄÍ∏∞ Ï§ë Ïã†Í≥† Ï°∞Ìöå | ‚úÖ Admin |
| PUT | `/api/emergency/admins/reports/{id}` | Ïã†Í≥† Ï≤òÎ¶¨ | ‚úÖ Admin |

### üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ (Í¥ÄÎ¶¨ÏûêÏö©)

| Î©îÏÑúÎìú | Í≤ΩÎ°ú | ÏÑ§Î™Ö | Ïù∏Ï¶ù ÌïÑÏöî |
|--------|------|------|----------|
| GET | `/api/admins/users` | Ïñ¥Î•¥Ïã† Î™©Î°ù Ï°∞Ìöå | ‚úÖ Admin |
| POST | `/api/admins/users` | Ïñ¥Î•¥Ïã† Îì±Î°ù | ‚úÖ Admin |
| PUT | `/api/admins/users/{id}` | Ïñ¥Î•¥Ïã† Ï†ïÎ≥¥ ÏàòÏ†ï | ‚úÖ Admin |

---

## Îç∞Ïù¥ÌÑ∞ ÌùêÎ¶Ñ ÏöîÏïΩ

### üéµ ÎÖ∏Îûò Ïû¨ÏÉù ÏãúÎÇòÎ¶¨Ïò§

1. **IoT Í∏∞Í∏∞**: ÏùåÏÑ± ÎÖπÏùå ‚Üí ÏóÖÎ°úÎìú
2. **STT**: ÏùåÏÑ± ‚Üí ÌÖçÏä§Ìä∏ Î≥ÄÌôò
3. **Intent Î∂ÑÏÑù**: "ÌÉúÏßÑÏïÑ ÎÖ∏Îûò ÌãÄÏñ¥Ï§ò" ‚Üí `SELECT_BY_ARTIST`
4. **ÎÖ∏Îûò Í≤ÄÏÉâ**: DBÏóêÏÑú ÌÉúÏßÑÏïÑ ÎÖ∏Îûò Ï∞æÍ∏∞
5. **History Í∏∞Î°ù**: Ï≤≠Ï∑® Ïù¥Î†• Ï†ÄÏû•
6. **TTS ÏÉùÏÑ±**: "ÌÉúÏßÑÏïÑÏùò ÏÇ¨ÎûëÏùÄ ÏïÑÎ¨¥ÎÇò ÌïòÎÇòÎ•º Ïû¨ÏÉùÌï†Í≤åÏöî"
7. **ÏùëÎãµ Î∞òÌôò**:
   - `ttsFileUrl`: TTS ÏùåÏÑ± URL
   - `songInfo.audioUrl`: S3 ÏùåÏïÖ ÌååÏùº URL
8. **Frontend**:
   - TTS Ïû¨ÏÉù
   - ÏùåÏïÖ Ïû¨ÏÉù (audioUrl)
   - **Ïû¨ÏÉù ÏÉÅÌÉúÎäî FrontendÍ∞Ä ÏôÑÏ†ÑÌûà Í¥ÄÎ¶¨**

### üö® Í∏¥Í∏â Ïã†Í≥† ÏãúÎÇòÎ¶¨Ïò§

1. **IoT Í∏∞Í∏∞**: "ÎèÑÏôÄÏ§ò!" ÏùåÏÑ± ÏóÖÎ°úÎìú
2. **STT**: "ÎèÑÏôÄÏ§ò" ÌÖçÏä§Ìä∏ Î≥ÄÌôò
3. **Intent Î∂ÑÏÑù**: `EMERGENCY`
4. **Í∏¥Í∏â Ïã†Í≥† ÏÉùÏÑ±**: DBÏóê Ï†ÄÏû•
5. **WebSocket ÏïåÎ¶º**: Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Ïã§ÏãúÍ∞Ñ Ìë∏Ïãú
6. **Admin Dashboard**: ÏïåÎ¶º ÌåùÏóÖ ÌëúÏãú
7. **Í¥ÄÎ¶¨Ïûê Ï≤òÎ¶¨**: ÌôïÏù∏ ÌõÑ Ï≤òÎ¶¨ ÏôÑÎ£å

---

## üîÑ ÌôïÏû• Í∞ÄÎä•ÏÑ±

### ÎØ∏Îûò Í∞úÏÑ† Î∞©Ìñ•

1. **Intent Î∂ÑÏÑù Í≥†ÎèÑÌôî**
   - ÌòÑÏû¨: ÌÇ§ÏõåÎìú Í∏∞Î∞ò Îß§Ïπ≠
   - ÎØ∏Îûò: RAG Í∏∞Î∞ò ÎòêÎäî LLM Í∏∞Î∞ò
   - ÍµêÏ≤¥ Î∞©Î≤ï: ÏÉàÎ°úÏö¥ `IntentClassifier` Íµ¨ÌòÑÏ≤¥ Ï∂îÍ∞Ä ‚Üí `@Primary` Î≥ÄÍ≤Ω

2. **Ï∂îÏ≤ú ÏãúÏä§ÌÖú**
   - `ListeningHistory` Îç∞Ïù¥ÌÑ∞ ÌôúÏö©
   - Í∞úÏù∏ÌôîÎêú ÎÖ∏Îûò Ï∂îÏ≤ú

3. **Í±¥Í∞ï Î™®ÎãàÌÑ∞ÎßÅ**
   - ÏùåÏÑ± Ìå®ÌÑ¥ Î∂ÑÏÑù
   - Ïù¥ÏÉÅ ÏßïÌõÑ Í∞êÏßÄ

4. **Îã§Ï§ë Í∏∞Í∏∞ ÏßÄÏõê**
   - Í±∞Ïã§, Ïπ®Ïã§ Îì± Ïó¨Îü¨ Í∏∞Í∏∞
   - Í∏∞Í∏∞ Í∞Ñ ÏÑ∏ÏÖò ÎèôÍ∏∞Ìôî
